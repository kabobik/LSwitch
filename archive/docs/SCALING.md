# Масштабирование интерфейса LSwitch

Приложение LSwitch Control Panel автоматически обнаруживает и применяет системное масштабирование мониторов.

## Как работает масштабирование

Приложение проверяет несколько источников информации о масштабировании в следующем порядке:

1. **Переменные окружения Qt**
   - `QT_SCALE_FACTOR` - явное указание масштаба
   - `QT_AUTO_SCREEN_SCALE_FACTOR` - автоматическое определение

2. **Переменные окружения GTK**
   - `GDK_SCALE` - масштаб для GTK приложений
   - `GDK_DPI_SCALE` - DPI-зависимое масштабирование

3. **GNOME параметры масштабирования**
   - `text-scaling-factor` - параметр GNOME для масштабирования текста

4. **Физический DPI монитора**
   - Если другие методы не определили масштаб, используется соотношение физического и логического DPI
   - Стандартный DPI = 96

5. **HiDPI поддержка**
   - Включены атрибуты Qt: `AA_EnableHighDpiScaling` и `AA_UseHighDpiPixmaps`

## Проверка текущего масштабирования

### Просмотр информации о мониторе

```bash
# Логический DPI (стандартно 96)
xdpyinfo | grep 'resolution:'

# Размер экрана в пикселях
xdpyinfo | grep 'dimensions:'

# GNOME текстовое масштабирование
gsettings get org.gnome.desktop.interface text-scaling-factor

# Переменные окружения
echo "QT_SCALE_FACTOR=$QT_SCALE_FACTOR"
echo "GDK_SCALE=$GDK_SCALE"
```

### Логирование из приложения

При запуске LSwitch Control Panel выводит информацию о обнаруженном масштабировании:

```bash
# Запустить с выводом логов
lswitch-control 2>&1 | grep -i масштаб
```

## Ручная настройка масштабирования

### Через переменные окружения

```bash
# Масштабирование 1.5x
export QT_SCALE_FACTOR=1.5
lswitch-control

# Через GDK_SCALE (для GTK приложений, но может помочь)
export GDK_SCALE=2
lswitch-control
```

### Через systemd сервис

Если вы хотите применить масштабирование для автозапуска, отредактируйте файл сервиса:

```bash
# Для пользовательского сервиса
systemctl --user edit lswitch

# Добавьте в [Service] секцию:
[Service]
Environment="QT_SCALE_FACTOR=1.5"
```

Затем перезагрузите сервис:

```bash
systemctl --user daemon-reload
systemctl --user restart lswitch
```

### Через GNOME параметры

```bash
# Установить масштабирование текста на 1.25x
gsettings set org.gnome.desktop.interface text-scaling-factor 1.25
```

## HiDPI мониторы (4K, 5K и т.д.)

Для HiDPI мониторов (где DPI > 96):

1. **Автоматическое определение**: Приложение автоматически определит коэффициент масштабирования
   
2. **Явное указание**: Если автоматическое определение не работает, используйте:
   ```bash
   export QT_SCALE_FACTOR=2.0  # для 4K мониторов (если логический DPI = 96)
   lswitch-control
   ```

3. **Проверка**: В заголовке окна будет показано текущее масштабирование
   ```
   LSwitch Control (масштаб x2.00)
   ```

## Типичные значения масштабирования

| Монитор | DPI | Масштаб |
|---------|-----|---------|
| 1080p 24" | 92 | 0.96 |
| 1440p 27" | 109 | 1.14 |
| 4K 27" | 163 | 1.70 |
| 4K 32" | 138 | 1.44 |
| Ноутбук FHD | 96 | 1.0 |
| Ноутбук 2K | 126 | 1.31 |

## Если масштабирование работает неправильно

1. **Проверьте логи приложения**:
   ```bash
   lswitch-control 2>&1
   ```

2. **Проверьте физический DPI монитора**:
   ```bash
   xdpyinfo | grep 'resolution:'
   ```

3. **Убедитесь, что экран определен правильно**:
   ```bash
   xrandr
   ```

4. **Установите масштаб явно**:
   ```bash
   export QT_SCALE_FACTOR=1.5
   lswitch-control
   ```

## Отключение HiDPI поддержки (не рекомендуется)

Если HiDPI поддержка вызывает проблемы, временно отключите её:

```bash
export QT_AUTO_SCREEN_SCALE_FACTOR=0
lswitch-control
```

## Дополнительные переменные Qt

- `QT_SCALE_FACTOR_ROUNDING_POLICY` - политика округления масштабирования
- `QT_SCREEN_SCALE_FACTORS` - масштабирование для конкретных экранов
- `QT_HIGH_DPI_SCALE_FACTOR_ROUNDING_POLICY` - округление для HiDPI

Примеры:

```bash
# Без округления
export QT_SCALE_FACTOR_ROUNDING_POLICY=Round
lswitch-control

# Для мультимониторных систем (масштаб для каждого экрана)
export QT_SCREEN_SCALE_FACTORS="1.0;2.0"
lswitch-control
```

## Мультимониторные системы

Если у вас несколько мониторов с разными DPI:

```bash
# Проверьте информацию обо всех мониторах
xrandr

# Установите масштабирование для конкретного экрана
export QT_SCREEN_SCALE_FACTORS="1.0;2.0"  # Первый экран 1x, второй 2x
lswitch-control
```

Приложение использует главный экран (`primaryScreen()`). Если это не работает правильно, отправьте баг-репорт с информацией о вашей конфигурации.
