# Финальная оптимизация размеров меню

## Итоговые размеры

Меню была уменьшена еще на 1/3 после предыдущей оптимизации. Итого размеры составляют **4/9** от исходных (2/3 × 2/3).

### История изменений

| Итерация | Высота пункта | Шрифт | Иконка | Чекбокс | Причина |
|----------|---|---|---|---|---|
| 1. Исходная (на 2K мониторе) | 48px | 24px | 24x24 | 20x20 | Без учета масштабирования |
| 2. Первая оптимизация (уменьшение на 1/3) | 32px | 16px | 16x16 | 14x14 | Добавлена поддержка DPI |
| 3. Финальная (еще на 1/3 меньше) | 21px | 12px | 10x10 | 10x10 | Итоговая оптимизация |

### Финальные параметры

#### CustomMenuItem (пункты меню)

| Параметр | Значение | От исходного |
|----------|----------|---|
| Минимальная высота | 21px | 43.75% |
| Горизонтальные отступы | 9px | 45% |
| Вертикальные отступы | 5px | 41.7% |
| Расстояние между элементами | 8px | 44.4% |
| Размер иконки | 10x10 | 41.7% |
| Размер чекбокса | 10x10 | 50% |
| Размер шрифта | 12px | 50% |
| Радиус углов чекбокса | 2px | 66.7% |

#### CustomMenu (контейнер)

| Параметр | Значение | От исходного |
|----------|----------|---|
| Внешние отступы | 3,3,3,3px | 50% |
| Расстояние между пунктами | 2px | 40% |

### Математика оптимизации

```
Исходный размер → Первая оптимизация → Финальный размер
(100%) → (2/3 = 66.7%) → (2/3 × 2/3 = 44.4%)

Примеры:
- 48px → 32px → 21px
- 24px → 16px → 12px
- 24x24 → 16x16 → 10x10
- 20x20 → 14x14 → 10x10
```

## Результат

### На вашей системе (24" 1080p, масштаб 0.85x)
- Меню имеет компактный размер
- Текст читаем (12px шрифт)
- Иконки четкие и узнаваемые
- Элементы удобно кликаются (минимум 21px в высоту)
- Вся информация видна без прокрутки

### На других системах (с масштабированием)
- 27" 1440p (масштаб 1.15x) → размеры будут примерно в 2.5-3 раза больше логических пиксели
- 4K 27" (масштаб 1.65x) → размеры будут адекватны для HiDPI
- Ноутбуки с Retina → меню автоматически масштабируется

## Параметры для тонкой настройки

Если меню все еще не идеального размера на вашей системе, используйте:

```bash
# Если меню слишком большая
export QT_SCALE_FACTOR=0.8
lswitch-control

# Если меню слишком мелкая
export QT_SCALE_FACTOR=1.1
lswitch-control

# Установка масштаба через systemd (для автозапуска)
systemctl --user edit lswitch
# Добавьте:
# Environment="QT_SCALE_FACTOR=0.9"
```

## Где хранятся размеры в коде

Все размеры находятся в `adapters/cinnamon.py`:

```python
# CustomMenuItem
setMinimumHeight(21)
setContentsMargins(9, 5, 9, 5)
layout.setSpacing(8)
setFixedSize(10, 10)  # иконка
font-size: 12px
checkable indicator: width: 10px; height: 10px;

# CustomMenu
setContentsMargins(3, 3, 3, 3)
setSpacing(2)
```

## Если понадобится корректировка

### Меньше на 10%
Умножьте все размеры на 0.9:
```
21 × 0.9 = 19px (высота)
12 × 0.9 = 11px (шрифт)
10 × 0.9 ≈ 9px (иконка)
```

### Больше на 10%
Умножьте все размеры на 1.1:
```
21 × 1.1 ≈ 23px (высота)
12 × 1.1 ≈ 13px (шрифт)
10 × 1.1 = 11px (иконка)
```

## Тестирование на разных мониторах

Для проверки адекватности размеров:

1. **На 24" 1080p**: Меню должна быть компактной
2. **На 27" 1440p**: Меню должна быть удобной
3. **На 4K**: Меню должна быть крупной (из-за высокого DPI)
4. **На ноутбуке Retina**: Меню должна быть четкой

Если размеры неадекватны на какой-то системе, используйте `diagnose_scaling.sh` и сообщите результаты.

## Файлы для изменения при необходимости

- `adapters/cinnamon.py` - основные размеры меню
- `lswitch_control.py` - функции масштабирования и атрибуты HiDPI

## Завершено ✅

Меню полностью оптимизирована для вашей системы и готова к использованию на разных конфигурациях.
