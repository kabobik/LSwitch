#!/usr/bin/env python3
"""Lightweight launcher used by the systemd unit to start the installed
package without triggering name-shadowing issues from the top-level shim.
"""
import sys
import os

# Ensure installed package location is discoverable and preferred
ALT_LIB = '/usr/local/lib/lswitch'
if os.path.isdir(ALT_LIB) and ALT_LIB not in sys.path:
    sys.path.insert(0, ALT_LIB)

# If a non-package `lswitch` module exists (for example the compatibility
# shim installed at /usr/local/bin/lswitch), remove it so imports resolve
# to the real package on disk.
_existing = sys.modules.get('lswitch')
if _existing is not None and not getattr(_existing, '__path__', None):
    try:
        del sys.modules['lswitch']
    except Exception:
        pass

import importlib

# Import and run the core implementation from the installed package
core = importlib.import_module('lswitch.core')
if hasattr(core, 'main'):
    core.main()
else:
    # Fall back to instantiating LSwitch if provided
    if hasattr(core, 'LSwitch'):
        app = core.LSwitch()
        app.run()
    else:
        raise RuntimeError('Core implementation not available')

