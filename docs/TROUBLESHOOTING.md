# üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º LSwitch

## –ü—Ä–æ–±–ª–µ–º–∞: –°–µ—Ä–≤–∏—Å –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

### –†–µ—à–µ–Ω–∏–µ

–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–∏ –≤—ã–≤–æ–¥–∞ Python –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —á–µ—Ä–µ–∑ systemd. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏.

### –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
sudo ./diagnose.sh
# –ò–ª–∏
make diagnose
```

### –®–∞–≥–∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è

1. **–û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å—Ç–∞—Ä—ã–π —Å–µ—Ä–≤–∏—Å:**
   ```bash
   sudo systemctl stop lswitch
   ```

2. **–û–±–Ω–æ–≤–∏—Ç–µ —Ñ–∞–π–ª—ã:**
   ```bash
   sudo cp lswitch.service /etc/systemd/system/
   sudo cp lswitch.py /usr/local/bin/lswitch
   sudo chmod +x /usr/local/bin/lswitch
   ```

3. **–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ systemd:**
   ```bash
   sudo systemctl daemon-reload
   ```

4. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å:**
   ```bash
   sudo systemctl start lswitch
   ```

5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   ```bash
   sudo journalctl -u lswitch -n 20
   ```

   –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
   ```
   üöÄ LSwitch –∑–∞–ø—É—â–µ–Ω
   ‚úì –ö–æ–Ω—Ñ–∏–≥ –∑–∞–≥—Ä—É–∂–µ–Ω: /etc/lswitch/config.json
   üöÄ LSwitch –∑–∞–ø—É—â–µ–Ω (evdev —Ä–µ–∂–∏–º)!
   ‚úì –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ XX —É—Å—Ç—Ä–æ–π—Å—Ç–≤
   ```

### –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

1. **systemd service —Ñ–∞–π–ª** ([lswitch.service](lswitch.service)):
   - –î–æ–±–∞–≤–ª–µ–Ω —Ñ–ª–∞–≥ `-u` –¥–ª—è Python (unbuffered)
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è `PYTHONUNBUFFERED=1`
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ä–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `WorkingDirectory=/etc/lswitch`
   - **–î–æ–±–∞–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ X11**: `DISPLAY=:0` –∏ `XAUTHORITY=/home/user/.Xauthority`

2. **Python —Å–∫—Ä–∏–ø—Ç** ([lswitch.py](lswitch.py)):
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–∏ stdout/stderr
   - –î–æ–±–∞–≤–ª–µ–Ω—ã `flush=True` –¥–ª—è –≤—Å–µ—Ö print()
   - –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å traceback

3. **–£—Å—Ç–∞–Ω–æ–≤–æ—á–Ω—ã–π —Å–∫—Ä–∏–ø—Ç** ([install.sh](install.sh)):
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è X-—Å–µ—Å—Å–∏–∏
   - –ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ XAUTHORITY –≤ unit —Ñ–∞–π–ª

## –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –õ–æ–≥–∏ –ø—É—Å—Ç—ã–µ

**–°–∏–º–ø—Ç–æ–º—ã:**
```bash
sudo journalctl -u lswitch
# –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ "Started lswitch.service..."
```

**–†–µ—à–µ–Ω–∏–µ:**
–û–±–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä–≤–∏—Å (—Å–º. "–®–∞–≥–∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è" –≤—ã—à–µ)

### 2. –°–µ—Ä–≤–∏—Å –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
sudo systemctl status lswitch
```

**–ï—Å–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "failed":**
```bash
# –°–º–æ—Ç—Ä–∏–º –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏
sudo journalctl -u lswitch -n 50

# –ü—Ä–æ–±—É–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é
sudo /usr/bin/python3 -u /usr/local/bin/lswitch
```

### 3. –ù–µ—Ç python3-evdev

**–°–∏–º–ø—Ç–æ–º—ã:**
```
ModuleNotFoundError: No module named 'evdev'
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
sudo apt update
sudo apt install python3-evdev
sudo systemctl restart lswitch
```

### 4. –ù–µ—Ç –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ /dev/input/

**–°–∏–º–ø—Ç–æ–º—ã:**
```
PermissionError: [Errno 13] Permission denied: '/dev/input/event0'
```

**–†–µ—à–µ–Ω–∏–µ:**
–°–µ—Ä–≤–∏—Å –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –æ—Ç root (—ç—Ç–æ —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –≤ systemd)

### 5. –î–≤–æ–π–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è (—Ç–µ–∫—Å—Ç –º–æ—Ä–≥–∞–µ—Ç)

**–°–∏–º–ø—Ç–æ–º—ã:**
–ü—Ä–∏ –¥–≤–æ–π–Ω–æ–º Shift —Ç–µ–∫—Å—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è, –Ω–æ —Å—Ä–∞–∑—É –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–æ.

**–ü—Ä–∏—á–∏–Ω–∞:**
–°–µ—Ä–≤–∏—Å –∑–∞–ø—É—â–µ–Ω –æ—Ç root –±–µ–∑ –¥–æ—Å—Ç—É–ø–∞ –∫ X11 —Å–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–†–µ—à–µ–Ω–∏–µ:**
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞:
```bash
sudo systemctl show lswitch | grep Environment=
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
Environment=PYTHONUNBUFFERED=1 DISPLAY=:0 XAUTHORITY=/home/USERNAME/.Xauthority
```

–ï—Å–ª–∏ –∏—Ö –Ω–µ—Ç - –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä–≤–∏—Å:
```bash
sudo ./uninstall.sh
sudo ./install.sh
```

### 6. –ö–æ–Ω—Ñ–ª–∏–∫—Ç —Å –¥—Ä—É–≥–∏–º–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∞–º–∏

–ï—Å–ª–∏ —É –≤–∞—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:
- xneur
- kbdd
- –¥—Ä—É–≥–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã –¥–ª—è —Ä–∞—Å–∫–ª–∞–¥–∫–∏

–û–Ω–∏ –º–æ–≥—É—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏—Ö:
```bash
sudo systemctl stop xneur
sudo systemctl disable xneur
```

## –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞

–ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç:

```bash
# 1. –£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é
sudo ./uninstall.sh

# 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–Ω–æ–≤–æ
sudo ./install.sh

# 3. –í–∫–ª—é—á–∏—Ç–µ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫
sudo systemctl enable lswitch
sudo systemctl start lswitch

# 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ
sudo systemctl status lswitch
sudo journalctl -u lswitch -f
```

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –°—Ç–∞—Ç—É—Å
sudo systemctl status lswitch

# –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
sudo journalctl -u lswitch -f

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 50 –∑–∞–ø–∏—Å–µ–π
sudo journalctl -u lswitch -n 50

# –õ–æ–≥–∏ —Å –æ—à–∏–±–∫–∞–º–∏
sudo journalctl -u lswitch -p err

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
sudo systemctl restart lswitch

# –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
sudo ./diagnose.sh
make diagnose

# –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ (–¥–ª—è —Ç–µ—Å—Ç–∞)
sudo /usr/bin/python3 -u /usr/local/bin/lswitch
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä
2. –ù–∞–±–µ—Ä–∏—Ç–µ: `ghbdtn`
3. –ë—ã—Å—Ç—Ä–æ –Ω–∞–∂–º–∏—Ç–µ Shift –¥–≤–∞–∂–¥—ã
4. –î–æ–ª–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å—Å—è: `–ø—Ä–∏–≤–µ—Ç`
5. –†–∞—Å–∫–ª–∞–¥–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

–ï—Å–ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Äî –≤—Å—ë –≤ –ø–æ—Ä—è–¥–∫–µ! ‚úÖ

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–º–æ—â—å

- [INSTALL.md](INSTALL.md) - –î–µ—Ç–∞–ª—å–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
- [EXAMPLES.md](EXAMPLES.md) - –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- [diagnose.sh](diagnose.sh) - –°–∫—Ä–∏–ø—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
