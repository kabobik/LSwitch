# Анализ масштабирования LSwitch

## Ваша система

**Конфигурация мониторов:**
- 2 монитора по 1920x1080 (разрешение FHD)
- Логический DPI: 96x96 (стандартный)
- GNOME/Cinnamon text-scaling-factor: 1.0 (без масштабирования)
- Desktop Environment: Cinnamon

**Рассчитанный масштаб:** 0.85x
- Причина: физический DPI (81.6) ниже логического (96)
- Это нормально для 24" мониторов с FHD

## Почему масштабирование может отличаться между системами

### 1. **Физический размер монитора**
   - 27" 1080p монитор имеет меньше пикселей на дюйм (PPI) чем 24" монитор
   - Результат: меньше масштабирование (0.8-0.9x)

### 2. **Разрешение экрана**
   - 1440p (2560x1440) на 27" → выше PPI → масштабирование ~1.1-1.2x
   - 4K (3840x2160) на 27" → очень высокий PPI → масштабирование ~1.6-1.8x

### 3. **Системные настройки**
   - GNOME text-scaling-factor (может быть 1.0, 1.25, 1.5, 2.0)
   - KDE система масштабирования
   - Переменные окружения (QT_SCALE_FACTOR, GDK_SCALE и т.д.)

### 4. **Оборудование**
   - HiDPI дисплеи (Retina, 4K, 5K мониторы)
   - Ноутбуки обычно имеют выше DPI чем мониторы

## Формула расчёта масштабирования

```
Масштаб = Физический DPI / Логический DPI
или
Масштаб = (Ширина мм × Разрешение по горизонтали / 25.4) / Логический DPI
```

**Примеры:**

### 24" FHD монитор (1920x1080)
```
Физический размер: ~530mm
DPI = (530mm × 1920px) / 25.4mm / 96 = ~0.82x
```

### 27" 1440p монитор (2560x1440)
```
Физический размер: ~600mm
DPI = (600mm × 2560px) / 25.4mm / 96 = ~1.09x
```

### 27" 4K монитор (3840x2160)
```
Физический размер: ~600mm
DPI = (600mm × 3840px) / 25.4mm / 96 = ~1.64x
```

### Ноутбук 13.3" FHD (1920x1080)
```
Физический размер: ~300mm
DPI = (300mm × 1920px) / 25.4mm / 96 = ~0.78x (обычно система устанавливает 1.0x или 1.25x)
```

## Как определить, нужно ли масштабирование

**На другой системе интерфейс кажется меньшим?**

Возможные причины:
1. **Другой монитор** (меньше физический размер при том же разрешении)
2. **Другое разрешение** (выше разрешение при том же размере)
3. **Отключено системное масштабирование** на той системе
4. **Другой DE** (KDE, GNOME, Xfce имеют разные подходы)

**Что проверить:**

```bash
# На проблемной системе запустите:
bash scripts/diagnose_scaling.sh

# Особое внимание на:
# - xrandr информацию о физическом размере монитора (mm)
# - Логический DPI (обычно 96)
# - text-scaling-factor если это GNOME/Cinnamon
```

## Решения для разных сценариев

### Интерфейс слишком мал на другой системе

**Вариант 1: Проверить xrandr информацию**
```bash
xrandr
# Посмотрите на строку вроде: "1920x1080+0+0 (normal ...) 530mm x 300mm"
# Если нет физического размера (0mm x 0mm), это может быть проблема
```

**Вариант 2: Установить масштаб явно**
```bash
export QT_SCALE_FACTOR=1.5
lswitch-control
```

**Вариант 3: Использовать GNOME/KDE параметры**
```bash
# GNOME
gsettings set org.gnome.desktop.interface text-scaling-factor 1.5

# KDE
# Параметры → Запуск и завершение → Шрифты
# или отредактируйте ~/.config/kdeglobals
```

### Интерфейс слишком большой на другой системе

**Решение то же:**
```bash
export QT_SCALE_FACTOR=0.8
lswitch-control
```

## Рекомендуемые масштабы

| Монитор/Ноутбук | Разрешение | Размер | Рекомендуемый масштаб |
|-----------------|-----------|--------|----------------------|
| Ноутбук стандартный | 1920x1080 | 13.3-15.6" | 1.0-1.25x |
| Ноутбук HiDPI | 2560x1440 | 13-14" | 1.5-1.75x |
| Ноутбук MacBook Pro Retina | 2880x1800 | 15" | 2.0x |
| Монитор 24" FHD | 1920x1080 | 24" | 0.8-1.0x |
| Монитор 27" 1440p | 2560x1440 | 27" | 1.0-1.15x |
| Монитор 27" 4K | 3840x2160 | 27" | 1.5-1.75x |
| Монитор 32" 4K | 3840x2160 | 32" | 1.2-1.4x |
| Ультраширокий 34" 1440p | 3440x1440 | 34" | 1.2-1.4x |

## Автоматическое масштабирование

LSwitch Control Panel автоматически:

1. ✓ Проверяет переменные окружения Qt и GTK
2. ✓ Проверяет GNOME параметры масштабирования
3. ✓ Рассчитывает масштаб из физического DPI
4. ✓ Включает HiDPI поддержку для качественного масштабирования
5. ✓ Логирует выбранный масштаб для диагностики

## Тестирование на разных системах

### Снимаем диагностику:
```bash
bash scripts/diagnose_scaling.sh > scaling_report.txt
# Отправляем файл для анализа
```

### Проверяем логирование:
```bash
lswitch-control 2>&1 | grep -i масштаб
```

### Тестируем разные масштабы:
```bash
for scale in 0.8 1.0 1.25 1.5 1.75 2.0; do
    echo "Testing scale $scale"
    export QT_SCALE_FACTOR=$scale
    timeout 2 lswitch-control 2>&1 | grep "Финальный"
done
```

## Если что-то работает неправильно

1. **Сделайте диагностику**: `bash scripts/diagnose_scaling.sh`
2. **Проверьте логи**: `lswitch-control 2>&1`
3. **Проверьте xrandr**: `xrandr | grep -E '(^[^ ]|connected)'`
4. **Установите масштаб явно**: `export QT_SCALE_FACTOR=1.5`
5. **Откройте issue** с результатами диагностики

## Заключение

Масштабирование в LSwitch работает автоматически на основе:
- Физического размера монитора (из xrandr)
- Разрешения экрана
- Логического DPI системы
- Системных параметров масштабирования (GNOME, KDE и т.д.)

Если интерфейс выглядит неправильно на другой системе, это скорее всего связано с разными параметрами монитора, а не с ошибкой приложения. Используйте `diagnose_scaling.sh` для проверки и `QT_SCALE_FACTOR` для ручной настройки если необходимо.
